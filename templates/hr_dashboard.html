{% extends 'base.html' %}

{% block main_content %}


<div class="row">
    <div class="col-sm-10 offset-1">
      <br><br>
     <h1 class="text-center">HR Dashboard</h1>
      <table class="pass">
        <style>
          .pass{
            margin-left: 150px;
          }
          td, th{
            padding: 10px;
          }
        </style>
        <table class="table" >
        <thead class="thead-light">
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">city</th>
            <th scope="col">Date and time</th>
            <th scope="col">Domain Applied for</th>
            <th scope="col">Phone</th>
            <th scope="col">Interviewer</th>

            <th scope="col">Possition applied for</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
         {% for st in data %}
          <tr>
            <th scope="row">{{st.id}}</th>
            <td>{{st.first_name}}</td>
            <td>{{st.email}}</td>
            <td>{{st.Address}}</td>
            <td>{{st.datetime}}</td>
            <td>{{st.domain_interview}}</td>
            <td>{{st.phone}}</td>
            <td>{{st.user}}</td>
            <td>{{st.position}}</td>
              <td>
<a href="{% url 'edit_data' %}?id={{st.id}}">Edit Data</a>

                <a href="#deleteEmployeeModal-{{forloop.counter}}" class="delete" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i>Delete</a>
                <div id="deleteEmployeeModal-{{forloop.counter}}" class="modal fade">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <form>
                        <div class="modal-header">						
                          <h4 class="modal-title">Delete Employee</h4>
                          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        </div>
                        <div class="modal-body">					
                          <p>Are you sure you want to delete these Records?</p>
                          <p class="text-warning"><small>{{st.first_name}} Information are delete</small></p>
                        </div>
                        <div class="modal-footer">
                          <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                          <a href="{% url 'delete_data' %}?id={{st.id}}" type="submit" class="btn btn-danger">Delete</a>
                        </div>
                      </form>
                    </div>
                  </div>
                  </div>
              
            </td>
          </tr>
         {% endfor %}
        </tbody>
      </table>
    </div>
   </div>


<div class="row">
<div class="col-sm-10 offset-1">
  <h1 class="text-center">2nd Attempt</h1>
  <table class="pass">
    <table class="table" >
      <thead class="thead-light">
    
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Name</th>
        <th scope="col">Email</th>
        <th scope="col">city</th>
        <th scope="col">Date and time</th>
        <th scope="col">Domain Applied for</th>
        <th scope="col">Phone</th>
        <th scope="col">Interviewer</th>

        <th scope="col">Possition applied for</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody>
     {% for st in data2 %}
      <tr>
        <th scope="row">{{st.id}}</th>
        <td>{{st.first_name}}</td>
        <td>{{st.email}}</td>
        <td>{{st.Address}}</td>
        <td>{{st.datetime}}</td>
        <td>{{st.domain_interview}}</td>
        <td>{{st.phone}}</td>
        <td>{{st.user}}</td>
        <td>{{st.position}}</td>
          <td>
            <a href="#deleteEmployeeModal-{{forloop.counter}}" class="delete" data-toggle="modal"><i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i>Delete</a>
            <div id="deleteEmployeeModal-{{forloop.counter}}" class="modal fade">
              <div class="modal-dialog">
                <div class="modal-content">
                  <form>
                    <div class="modal-header">						
                      <h4 class="modal-title">Delete Employee</h4>
                      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">					
                      <p>Are you sure you want to delete these Records?</p>
                      <p class="text-warning"><small>{{st.first_name}} Information are delete</small></p>
                    </div>
                    <div class="modal-footer">
                      <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                      <a href="{% url 'delete_data' %}?id={{st.id}}" type="submit" class="btn btn-danger">Delete</a>
                    </div>
                  </form>
                </div>
              </div>
              </div>
          
        </td>
      </tr>
     {% endfor %}
    </tbody>
</table>

</div>
</div>






{% endblock main_content %}

{% block custom_js %}
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.14.6/firebase-messaging.js"></script>
<script>
    var firebaseConfig = {
        apiKey: "AIzaSyAa2J8MJTT0ykq6iV_oHWPSPe_9SazCNGE",
        authDomain: "notification-1a1a5.firebaseapp.com",
        projectId: "notification-1a1a5",
        storageBucket: "notification-1a1a5.appspot.com",
        messagingSenderId: "82591525914",
        appId: "1:82591525914:web:67e40a1eaaa0d84f6475a3",
    };
    firebase.initializeApp(firebaseConfig);
    const messaging=firebase.messaging();

    function IntitalizeFireBaseMessaging() {
        messaging
            .requestPermission()
            .then(function () {
                console.log("Notification Permission");
                return messaging.getToken();
            })
            .then(function (token) {
                console.log("Token : "+token);
                sendToServer(token);
            })
            .catch(function (reason) {
                console.log(reason);
            });
    }

    messaging.onMessage(function (payload) {
        console.log(payload);
        const notificationOption={
            body:payload.notification.body,
            icon:payload.notification.icon
        };

        if(Notification.permission==="granted"){
            var notification=new Notification(payload.notification.title,notificationOption);

            notification.onclick=function (ev) {
                ev.preventDefault();
                window.open(payload.notification.click_action,'_blank');
                notification.close();
            }
        }

    });
    messaging.onTokenRefresh(function () {
        messaging.getToken()
            .then(function (newtoken) {
                console.log("New Token : "+ newtoken);
                sendToServer(newtoken);
            })
            .catch(function (reason) {
                console.log(reason);
            })
    });

    function sendToServer(token){
         $.ajax({
                url:'http://127.0.0.1:8000/hr_fcm_save/',
                type:'POST',
                data:{token:token},
            })
            .done(function(response){
                if(response=="True"){
                    console.log("Token Save")
                }
                else{
                    console.log("Error in Token Save")
                }
            });
    }
    IntitalizeFireBaseMessaging();
  </script>
{% endblock custom_js%}